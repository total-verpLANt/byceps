{% extends 'layout/admin/lan_tournament.html' %}
{% from 'macros/admin.html' import render_backlink %}
{% from 'macros/icons.html' import render_icon %}
{% from 'macros/misc.html' import render_tag %}
{% set current_page_party = party %}
{% set current_tab = 'tournaments' %}
{% set page_title = [_('Matches'), tournament.name, party.title] %}

{% block before_body %}
{{ render_backlink(url_for('.view', tournament_id=tournament.id),
                   _('Tournament')) }}
{%- endblock %}

{% block body %}

  <h1 class='title'>{{ _('Matches') }}</h1>

  {%- if match_data %}
  <table class='table table--wide'>
    <thead>
      <tr>
        <th>{{ _('Match #') }}</th>
        <th>{{ _('Contestants') }}</th>
        <th>{{ _('Score') }}</th>
        <th>{{ _('Status') }}</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {%- for data in match_data %}
      {%- set match = data.match %}
      {%- set contestants = data.contestants %}
      <tr>
        <td>{{ match.match_order }}</td>
        <td>
          {%- if contestants|length == 1 %}
            {# Defwin match: only one contestant, free advancement #}
            {%- set contestant = contestants[0] %}
            {%- if contestant.team_id %}
              Team: {{ teams_by_id.get(contestant.team_id, {}).name|default(contestant.team_id|string, true) }}
            {%- elif contestant.participant_id %}
              Player: {{ participants_by_id.get(contestant.participant_id, {}).screen_name|default(contestant.participant_id|string, true) }}
            {%- else %}
              BYE
            {%- endif %}
            {{ render_tag(_('defwin - Advanced'), class='color-info', icon='arrow-right') }}
          {%- else %}
            {# Normal match: multiple contestants #}
            {%- for contestant in contestants %}
              {%- if contestant.team_id %}
                Team: {{ teams_by_id.get(contestant.team_id, {}).name|default(contestant.team_id|string, true) }}
              {%- elif contestant.participant_id %}
                Player: {{ participants_by_id.get(contestant.participant_id, {}).screen_name|default(contestant.participant_id|string, true) }}
              {%- else %}
                BYE
              {%- endif %}
              {%- if not loop.last %} vs {% endif %}
            {%- endfor %}
          {%- endif %}
        </td>
        <td>
          {%- for contestant in contestants %}
            {{ contestant.score|default('â€“', true) }}
            {%- if not loop.last %} : {% endif %}
          {%- endfor %}
        </td>
        <td>
          {%- if match.confirmed_by %}
            {{ render_tag(_('Confirmed'), class='color-success') }}
          {%- else %}
            {{ render_tag(_('Pending'), class='color-warning') }}
          {%- endif %}
        </td>
        <td>
          <a href='{{ url_for('.view_match', match_id=match.id) }}'
             class='button button--compact'>
            {{ render_icon('view') }} {{ _('Details') }}
          </a>
        </td>
      </tr>
      {%- endfor %}
    </tbody>
  </table>
  {%- else %}
  <p class='dimmed'>{{ _('No matches have been created yet.') }}</p>
  {%- endif %}

{%- endblock %}
